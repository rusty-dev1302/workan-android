<!-- Filter Modal -->
<div class="modal fade" id="addFilterModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
  aria-labelledby="addFilterModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addFilterModalLabel">Filters</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <section class="container">
          <div class="row">

            <div class="form-section" style="padding: 0!important;">

              <!-- User Form Starts -->
              <form #editListing="ngForm">

                <div class="mb-1">
                  <div class="row g-3">

                    <div class="col-12">
                      <div class="form-group">
                        <label for="subcategory">Subcategory</label>
                      </div>
                      <select #subcategory class="form-select" aria-label="subcategory" [value]="currentSubcategory"
                        (change)="selectSubcategory(subcategory.value)">
                        <option default hidden>--</option>
                        <option value="" hidden>--</option>
                        <option *ngFor="let subCategory of subCategories" [value]="subCategory">
                          {{subCategory}}</option>
                      </select>
                    </div>

                    <div class="col-12">
                      <div class="form-group">
                        <label for="sortBy">Sort by</label>
                      </div>
                      <select #sortBy class="form-select" aria-label="sortBy" [value]="sortByValue"
                        (change)="selectSortBy(sortBy.value)">
                        <option default hidden>--</option>
                        <option value="" hidden>--</option>
                        <option *ngFor="let sortElement of sortByArray" [value]="sortElement">
                          {{sortElement}}</option>
                      </select>
                    </div>

                    <div class="col-12">
                      <div class="form-group">
                        <app-select-map-location headline="Location" [initialValue]="currentLocation"
                          (outputEvent)="locationSelectorOutput($event)"></app-select-map-location>
                      </div>
                    </div>

                    <div class="col-12 text-end">
                      <h5 style="font-size: 1rem!important;"><a class="link" data-bs-dismiss="modal" type="button"
                          (click)="clearAllFilters()">Clear all</a></h5>
                    </div>

                  </div>
                </div>

                <!-- Edit buttons -->
                <div class="mt-2" style="padding-top: .4rem;">
                  <div class="row">
                    <div class="modal-footer">
                      <button type="submit" class="btn btn-danger btn-rounded col-12" data-bs-toggle="modal"
                        data-bs-target="#addFilterModal" data-bs-dismiss="modal"
                        (click)="handleListProducts(true)">Save</button>
                    </div>
                  </div>
                </div>

              </form>
              <!-- User Form Ends -->
            </div>

          </div>
        </section>

      </div>
    </div>
  </div>
</div>
<!-- Filter Modal Ends -->

<!--Divider section-->
<section class="bg-color py-2">
  <section class="container">
    <div class="row">

      <div
        class="d-flex flex-column align-items-start justify-content-end col-xl-8 xol-lg-8 col-md-12 col-12 order-1 order-lg-0 text-md-start text-center">
        <h1 class=" text-capitalize fw-bolder text-white">
          Listings
        </h1>
      </div>

    </div>
  </section>
</section>

<!--Divider section end -->


<div class="content-box">

  <!-- navigation bar starts -->
  <nav class="nav navbar nav-underline justify-content-end align-items-start navbar-dark"
    style="background-color: #222;">

    <li class="nav-item">
      <a type="button" (click)="getListingSubcategories()" data-bs-toggle="modal" data-bs-target="#addFilterModal"
        style="margin-right: 1rem!important;color: white;">
        <i *ngIf="currentSubcategory!=''||geoHash!=''||sortByValue!=''" class="fa fa-circle" aria-hidden="true"
          style="font-size: .5rem!important;color: red;position: absolute;top: .7rem;right: .7rem;"></i>
        <svg xmlns="http://www.w3.org/2000/svg" fill="#FFFFFF" width="18" height="18" viewBox="0 0 20 20"
          aria-labelledby="icon-svg-title- icon-svg-desc-" role="img" class="sc-rbbb40-0 iwHbVQ">
          <title>Filters</title>
          <path
            d="M2.14 6.42h7.26c0.353 1.207 1.45 2.074 2.75 2.074s2.397-0.867 2.745-2.054l0.005-0.020h2.96c0.343-0.059 0.6-0.355 0.6-0.71s-0.258-0.651-0.596-0.709l-0.004-0.001h-2.94c-0.341-1.226-1.447-2.11-2.76-2.11s-2.419 0.885-2.755 2.090l-0.005 0.020h-7.26c-0.343 0.059-0.6 0.355-0.6 0.71s0.257 0.651 0.596 0.709l0.004 0.001zM12.16 4.28c0.776 0.011 1.4 0.643 1.4 1.42 0 0.784-0.636 1.42-1.42 1.42-0.777 0-1.409-0.624-1.42-1.399l-0-0.001c-0-0.006-0-0.013-0-0.020 0-0.784 0.636-1.42 1.42-1.42 0.007 0 0.014 0 0.021 0l-0.001-0zM17.86 13.58h-7.24c-0.328-1.245-1.443-2.148-2.77-2.148s-2.442 0.903-2.766 2.128l-0.004 0.020h-2.94c-0.036-0.006-0.077-0.010-0.12-0.010-0.398 0-0.72 0.322-0.72 0.72s0.322 0.72 0.72 0.72c0.042 0 0.084-0.004 0.124-0.011l-0.004 0.001h2.96c0.353 1.207 1.45 2.074 2.75 2.074s2.397-0.867 2.745-2.054l0.005-0.020h7.26c0.343-0.059 0.6-0.355 0.6-0.71s-0.258-0.651-0.596-0.709l-0.004-0.001zM7.84 15.72c-0.776-0.011-1.4-0.643-1.4-1.42 0-0.784 0.636-1.42 1.42-1.42 0.777 0 1.409 0.624 1.42 1.399l0 0.001c0 0.006 0 0.013 0 0.020 0 0.784-0.636 1.42-1.42 1.42-0.007 0-0.014-0-0.021-0l0.001 0z">
          </path>
        </svg> Filters
      </a>
    </li>

  </nav>
  <!-- navigation bar ends -->
  <section *ngIf="listings?.length != 0" class="common-section blog-section">

    <div class="container" infiniteScroll [infiniteScrollDistance]="2" [infiniteScrollThrottle]="50"
      (scrolled)="onScroll()">

      <div class="row g-3 mt-4">
        <div class="col-xl-3 col-md-6 col-12" *ngFor="let listing of listings">
          <div class="d-flex justify-content-center align-items-center">
            <div class="card list-card py-3" style="width: 25rem;padding-bottom: 0!important;">
              <img *ngIf="!listing.professional.profilePhoto" alt="..." class="card-img-top" src="assets/profile.png">
              <img *ngIf="listing.professional.profilePhoto" alt="..." class="card-img-top"
                [src]="'data:image/png;base64,'+listing.professional.profilePhoto.picByte">
              <div class="card-body">
                <h4 class="card-title">{{listing.professional.firstName}} {{listing.professional.lastName}}</h4>

                <h6 *ngIf="listing"><b><i class="fa-solid fa-dollar-sign" style="color: green;"></i> {{listing.charges |
                    number : '1.2-2'}}</b>
                  ({{listing.chargesType}})</h6>

                <h6><i class="fa fa-star rating-color"></i> {{listing.professional.rating | number : '1.1-1'}}</h6>
                <div class="col-12">
                  <a class="btn border btn-small btn-danger btn-rounded col-12"
                    [routerLink]="['/listingDetail',listing.id]" type="button">
                    View</a>
                </div>
                <hr class="style1">
                <p class="card-text mt-2 mb-3">
                <h6><b>Spec:</b><span> {{listing.subCategory.subCategoryName}}</span></h6>
                <h6><b>Exp:</b><span> {{listing.experience>5?'> 5':listing.experience}} Years</span></h6>
                <h6><b>Speaks:</b>
                  <span>
                    {{listing.professional.languages.join(', ').length>15?(listing.professional.languages.join(',
                    ')|slice:0:15)+' ...more':listing.professional.languages.join(', ')}}
                  </span>
                </h6>
                <h6><b>Location:</b><span> {{listing.location.length>20?(listing.location|slice:0:20)+'
                    ...more':listing.location}}</span></h6>
                <hr class="style1" style="margin: 0;">

                <span *ngIf="timezoneOffset==listing.timezoneOffset" style="font-weight:bold;letter-spacing:1px;color:rgb(69, 69, 69)">
                  <span *ngIf="!listing.availabilityLoaded"><i class="fas fa-spinner fa-pulse"></i></span>
                  <span *ngIf="listing.availabilityLoaded&&(listing.availableToday||listing.availableTomorrow)" style="font-size: 1rem!important;">
                    <span style="font-size: .8rem!important;">Slots available for </span>
                    <span *ngIf="listing.availableToday"
                      style="border-radius: 5px;font-size: .8rem!important;">Today</span>
                    <span *ngIf="listing.availableToday&&listing.availableTomorrow" style="font-size: .8rem!important;"> and </span>
                    <span *ngIf="listing.availableTomorrow"
                      style="border-radius: 5px;" style="font-size: .8rem!important;">Tomorow</span>
                  </span>
                </span>
                <span
                  style="font-size: .8rem;color: rgb(255, 66, 66);font-weight: bold;letter-spacing:.7px">{{timezoneOffset==listing.timezoneOffset?'':'The
                  listing is in different timezone'}}</span>
              </div>
            </div>
          </div>
        </div>

      </div>

    </div>
  </section>

</div>

<section *ngIf="listings?.length == 0" class="common-section business-section text-center" id="online_services"
  style="background-color:white">

  <div *ngIf="!listingsLoading" class="container" style="padding-top: 4rem;padding-bottom: 4rem;">
    <div class="col-xl-12 col-md-12">
      <div class="form-section">
        <img alt="GIF Image" src="assets/no_professional.gif" width="70%">
      </div>
    </div>
  </div>
  <div *ngIf="listingsLoading" class="container"
    style="padding-top: 4rem;padding-bottom: 4rem;min-height:20rem!important">
    <div class="col-xl-12 col-md-12">
      <div class="form-section">
        <i class="fas fa-spinner fa-pulse" style="font-size: xxx-large;"></i>
      </div>
    </div>
  </div>

</section>